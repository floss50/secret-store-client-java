sudo: false
language: java
jdk:
- oraclejdk8
services:
- docker
cache:
  directories:
  - "$HOME/.cache"
# export GPG details
before_install:
- echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import
- echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust
install:
- mvn --settings .maven.xml install -Dgpg.skip -Dmaven.javadoc.skip=true -B -V
- mvn help:evaluate -Dexpression=project.version | grep -e '^[^\[]'
- export secretstore_project_version=$(mvn help:evaluate -Dexpression=project.version | grep -e '^[^\[]')
deploy:
- provider: script
  skip_cleanup: true
  script: mvn clean deploy --settings .maven.xml -B -U -Prelease
  on:
    tags: true
    all_branches: true
- provider: releases
  skip_cleanup: true
  api_key:
    secure: ffeBw4uP0bM9u1UI8yrCtOIgp5Zj8CVlwz9Dih3P04XvfYaqc3Svo6bmTLl5QiCY8lhxaDAka48KpQOza1wSVXqMEHrw1zkfINWwnz3Yij5OPXOEaVT1hXbKvRjK4mzQQ/WwZYYpLp5h8jcRVaXMoCoTlFzDJqCyZ2QAM023Jm/acKWfHFpZEzg/o8iAYXQ33qEYnrtLgQCgTJYcJLjIPN8irpzXfhN6Ds6qvHcgIgVqHDiDf5TkQcYv7yaZbPd35iEw49HGXXgXXm3NFSMI6x0NJoXleYGbcZBnFeUF0Q3Q84roGhQp/R8/WPRI6bk3KW04KSgA5yIviYDw0m47/hv6rAChNzObhA/jr/3dSY2y2zd2WYDvY+FdpkfDusjHUYwOtFLjTbghNnR5L1QJCtCMIVtDFddGssoaEHcKPe3bCi+01cZcjBst/eAv+hl+ehquVPdsOVStFOuHo3o1jhZW9RMxIqGOirHcuudlsUDwG9rJGx62QND69oj6MRCesDEtwZPfONAEKHeowtecNdgywkyakwCVWYZsWM3xsosA5Zdr8hujibcKwybvPy4w0aaD0BLHe4gSXeewLUtxsNS5yGtHlF5GmFO85CIILUzfv0Gn/7Htq3VYv2Hx6+2Dk9kmSWOm7YvKWQ0rGPSo0CJNQYJgU+4KYifUrq3QrWs=
  file:
  - target/secret-store-client-$secretstore_project_version.jar
  name: "$secretstore_project_version"
  on:
    tags: true
    all_branches: true
